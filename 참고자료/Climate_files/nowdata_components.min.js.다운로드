/*
 * NOWData components
 * 4-May-2021 update
 * 
 * Keith Eggleston
 *  Northeast Regional Climate Center
 */
var cwa;function getCwa(){var e,t=document.URL.split("/");for(cwa="",e=t.length-1;e>0;e-=1)if(""!==t[e]&&"#map"!==t[e]){cwa=t[e];break}"hnl"===cwa?cwa="hfo":"samoa"===cwa?cwa="ppg":"guam"===cwa?cwa="gum":"pafc"===cwa?cwa="afc":"pafg"===cwa?cwa="afg":"pajk"===cwa&&(cwa="ajk")}function updatePor(e){input_params={sids:e,meta:["valid_daterange"],elems:[1,2,4,10,11]},postResults("/StnMeta",function(e){var t,a,n=[],i=[];!e.error&&e.meta&&e.meta[0].valid_daterange&&e.meta[0].valid_daterange.length&&($.each(e.meta[0].valid_daterange,function(e,t){t.length>0&&(n.push(parseInt(t[0].substr(0,4),10)),i.push(parseInt(t[1].substr(0,4),10)))}),t=Array.min(n),a=Array.max(i),$.datepicker.setDefaults({yearRange:t+":"+a}))})}function saveStn(e,t){$("#selectedStation").data({sid:e}).find("span.stationName").html(t),updatePor(e)}function clearMarkers(){markersArray&&($.each(markersArray,function(e,t){map.removeLayer(t)}),markersArray.length=0)}function addMarker(e,t){var a,n={triangleIcon:L.icon({iconUrl:"/images/triangle_12.png",iconSize:[13,12],origin:[0,0],iconAnchor:[6,6]}),bppIcon:L.icon({iconUrl:"/images/blue-pushpin_sm.png",shadowUrl:"/images/lbs_shadow.png",iconSize:[24,24],shadowSize:[36,24],origin:[0,0],iconAnchor:[9,24],shadowAnchor:[9,24]}),stationIcon:L.icon({iconUrl:"/images/blues_small.gif",iconSize:[24,24],origin:[0,0],iconAnchor:[9,24]}),cocoIcon:L.icon({iconUrl:"/images/cocorahs_small.gif",iconSize:[16,16],origin:[0,0],iconAnchor:[8,8]}),snotelIcon:L.icon({iconUrl:"/images/snotel_small.gif",iconSize:[16,16],origin:[0,0],iconAnchor:[8,8]}),rawsIcon:L.icon({iconUrl:"/images/raws_small.gif",iconSize:[16,16],origin:[0,0],iconAnchor:[8,8]}),centerIcon:L.icon({iconUrl:"/images/center.png",iconSize:[18,18],origin:[0,0],iconAnchor:[9,9]})};return n[t]&&(a=new L.marker(e,{icon:n[t]}).addTo(map),markersArray.push(a)),a}function displayStations(e){var t=$("#showStations span.ui-button-text").text();e.meta&&(clearMarkers(),$.each(e.meta,function(e,t){var a,n,i,s;t.ll&&(a=new L.LatLng(t.ll[1],t.ll[0]),i="bppIcon",$.each(t.sids,function(e,t){"10"===(s=t.split(" "))[1]?i="cocoIcon":"6"===s[1]&&"USS"===s[0].substr(0,3)?i="snotelIcon":"6"===s[1]&&"USR"===s[0].substr(0,3)&&(i="rawsIcon")}),n=addMarker(a,i),L.DomEvent.addListener(n,"mouseover",function(){$("#map_msg").html("<span>"+t.name+" <i>(click to select)</i></span>")}),L.DomEvent.addListener(n,"mouseout",function(){$("#map_msg").empty()}),L.DomEvent.addListener(n,"click",function(){$("select[name=station]").val(t.sids[0]),saveStn(t.sids[0],t.name),$("#selectedStation").show(),$("select[name=station]").hide(),hideMap()}))}),t.search("more")>=0?$("#showStations").off("click").on("click",displayMenuStations).find("span.ui-button-text").text("Show fewer stations"):$("#showStations").off("click").on("click",displayCwaStations).find("span.ui-button-text").text("Show more stations"),$("#showStations").position({my:"right center",at:"left-5 center",of:"#mapHelp"}))}function displayCwaStations(){input_params={cwa:cwa,meta:"name,ll,sids",elems:"maxt,mint,pcpn,snow,snwd",sDate:Date.today().addYears(-1).toString("yyyy-MM-dd"),eDate:Date.today().toString("yyyy-MM-dd")},$("#map_msg").empty().loadSpinner({message:"Searching for stations ..."}),postResults("/StnMeta",displayStations)}function displayMenuStations(){var e=[];$.each($("select[name=station] option"),function(t,a){e.push(a.value)}),input_params={sids:e,meta:"name,ll,sids"},postResults("/StnMeta",displayStations)}function mapInit(){input_params={meta:"bbox,geojson",id:cwa},postResults("/General/cwa",function(e){var t,a,n;e.meta.length>0?(t=e.meta[0].bbox,a=new L.LatLng((t[1]+t[3])/2,(t[0]+t[2])/2),n=new L.LatLngBounds(new L.LatLng(t[1],t[0]),new L.LatLng(t[3],t[2])),map=L.map("map_img",{center:a}).fitBounds(n),L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"}).addTo(map),L.geoJson(e.meta[0].geojson,{style:{color:"#0000ff",fillOpacity:.1,opacity:.4,weight:2,clickable:!1}}).addTo(map),displayMenuStations()):(hideMap(),$("#viewMap").remove())})}function showMap(){var e;$("#map_area").is(":visible")||$("#map_area").show("slide",400,function(){map||(e=$(".container").height()-58,$("#map_img").css("height",e),$("#map_area").append('<button id="closeMap">Close map</button><button id="mapHelp">Help</button><button id="showStations">Show fewer stations</button>'),$("#closeMap").button().on("click",hideMap).position({my:"right center",at:"right-5 center",of:"#map_msg"}),$("#mapHelp").button().on("click",{file:"/help/mapHelp.html"},displayHelp).position({my:"right center",at:"left-5 center",of:"#closeMap"}),$("#showStations").button().position({my:"right center",at:"left-5 center",of:"#mapHelp"}),mapInit())})}function hideMap(){$("#map_area").is(":visible")&&$("#map_area").hide("slide","fast")}function productDescription(e){return{StnProduct_moncrt:"DAILY DATA FOR A MONTH - daily maximum, minimum and average temperature (degrees F), average temperature departure from normal (degrees F), heating and cooling degree days (base 65), precipitation, snowfall and snow depth (inches) for all days of the selected month. Basic monthly summary statistics are also provided.",StnProduct_almanac:"DAILY ALMANAC - temperature (degrees F), precipitation, snowfall, snow depth (inches) and degree day (base 65) data for the requested day, month-to-date and year-to-date. Results are provided for the requested year, the normals and period-of-record extreme values. Comparisons to other years can also be requested.",StnProduct_monavg:"MONTHLY SUMMARIZED DATA - calculates averages, totals, daily extremes or frequencies for the selected variable for each month of the year for the selected range of years. Note: trace precipition/snowfall/snow depth amounts are treated as zero in sums, mean, and number of days counts. Annual average temperatures are the average of the twelve monthly values. Temperatures are reported in degrees F; precipitation, snowfall and snow depth are reported in inches.",StnProduct_dayavg:"CALENDAR DAY SUMMARIES - for each calendar day of the year, provides the mean, extreme daily value, or frequency of days meeting criteria based on the selected range of years. For extremes, the year of occurrence is also provided. Temperatures are reported in degrees F; precipitation, snowfall and snow depth are reported in inches.",StnProduct_normals:"DAILY/MONTHLY NORMALS - daily and monthly official NCDC 1991-2020 normals. Temperature and degree day normals are not available for locations where temperatures have not been routinely recorded. Normals will not necessarily match 30-year averages of the raw data. Normals have not been computed for some stations. Temperatures are reported in degrees F; precipitation, snowfall and snow depth are reported in inches. <a href='https://www.ncei.noaa.gov/access/us-climate-normals/' target='_blank'>Reference.</a>",StnProduct_oneday:"CLIMATOLOGY FOR A DAY - daily temperature (degrees F), precipitation, snowfall and snowdepth (inches) for a specific day over a range of years. Also statistics summarizing these values over the period specified.",StnProduct_fldates:"FIRST/LAST DATES - determines annual first and last dates of event occurrences (such as last spring and first fall freeze) for the specified range of years. Enter temperature value in degrees F; enter snowfall/snow depth value in inches.",StnProduct_dlytmpgrf:"TEMPERATURE GRAPHS - plot of daily max/min temperatures (degrees F) for the period specified, along with the normal temperature range and daily all-time records.",StnProduct_dlyaccgrf:"ACCUMULATION GRAPHS - plot of accumulated of precipition, snowfall (inches) or degree days from start to end date. For periods of 1 year or less, the normal (if available) and highest and lowest years with no more than one day missing are also plotted. For periods of more than 1 year, accumulations can be reset on a given date each year."}[e]}function flDateDisplaySmry(e){return"M"===e?"-":Date.parse("2000-"+e).toString("MMM-dd")}function flDateDisplay(e){return"M"===e?"-":Date.parse(e).toString("MMM-dd (yyyy)")}function fillRowVals(e,t,a){$(".basictable tbody tr:nth-child("+(t+1)+") td:nth-child("+a+")").text(flDateDisplay(e[0]))}function displayFirstLast(e){var t,a,n,i,s,r=getGroupResults(),o="01-01"===input_params.elems[0].season_start?"calyr":"season",l=r===o?"firlas":"lasfir",d="firlas"===l?3:2,c=JSON.parse(JSON.stringify(e.smry)),p="First/Last Occurrence Summary for "+e.meta.name+", "+e.meta.state;e.data=trimListByMcnt(e.data,1,2),i=parseInt(e.data[0][0].substr(0,4),10),s=parseInt(e.data[e.data.length-1][0].substr(0,4),10),addDisplayTitle(p,"<br /><span class='subtitle'>Each column contains date and year of occurrence</span>","html","basictable"),$.each("firlas"===l?["Date","First","Last"]:["Date","Last","First"],function(e,a){t+="<th>"+a+"</th>"}),addDisplayHead(t,"html","basictable"),$.each(e.data,function(e,n){a="season"===r&&"season"===o?parseInt(n[0].substr(0,4),10)-1+"-"+n[0].substr(0,4):"season"===r&&"season"!==o?n[0].substr(0,4)+"-"+(parseInt(n[0].substr(0,4),10)+1):n[0].substr(0,4),t="<td>"+a+"</td><td></td><td></td>",addDisplayRow(t,"html","basictable"),fillRowVals(n[1],e,d)}),input_params.elems[0].reduce.reduce=input_params.elems[0].reduce.reduce.replace("last","first"),input_params.sDate=i+(r!==o?1:0)+input_params.sDate.substr(4),input_params.eDate=s+(r!==o?1:0)+input_params.eDate.substr(4),postResults("/StnData",function(e){d="firlas"===l?2:3,$.each(e.data,function(e,t){fillRowVals(t[1],e,d)}),n="firlas"===l?[e.smry[0],c[0]]:[c[0],e.smry[0]],addDisplayFoot("<td>Minimum</td><td>"+flDateDisplay(n[0][2])+"</td><td>"+flDateDisplay(n[1][2])+"</td>","html","basictable"),addDisplayFoot("<td>Mean</td><td>"+flDateDisplaySmry(n[0][1])+"</td><td>"+flDateDisplaySmry(n[1][1])+"</td>","html","basictable"),addDisplayFoot("<td>Maximum</td><td>"+flDateDisplay(n[0][0])+"</td><td>"+flDateDisplay(n[1][0])+"</td>","html","basictable")})}function addMoncrtHeader(e,t){var a="";a+='<th class="sorter-isoDate col0" rowspan=2>Date</th>',a+='<th class="tcols" colspan=4>Temperature</th>',a+='<th class="sorter-sorttrace string-bottom col5" rowspan=2>HDD</th>',a+='<th class="sorter-sorttrace string-bottom col6" rowspan=2>CDD</th>',a+='<th class="sorter-sorttrace string-bottom col7" rowspan=2>Precipitation</th>',a+='<th class="sorter-sorttrace string-bottom col8" rowspan=2>New Snow</th>',a+='<th class="sorter-sorttrace string-bottom col9" rowspan=2>Snow Depth</th>',addDisplayHead(a,e),a='<th class="sorter-sorttrace string-bottom col1">Maximum</th>',a+='<th class="sorter-sorttrace string-bottom col2">Minimum</th>',a+='<th class="sorter-sorttrace string-bottom col3">Average</th>',a+='<th class="sorter-sorttrace string-bottom col4">Departure</th>',addDisplayHead(a,e)}function process_smry(e,t,a){var n,i,s,r,o,l,d,c,p,m,u=getTempRounding(),h=["Sum","Average","Normal"];for(r=e.data[0][5],o=e.data[0][6],l=e.data[0][19],d=e.data[0][20],c=e.data[0][21],p=e.data[0][22],m=e.data[0][23],"0.00"===c&&(c="T"),"0.0"===p&&(p="T"),"0"===m&&(m="T"),$(".tablesorter tbody tr").each(function(t,a){$(a).children("td").each(function(t,a){if("M"!==$(a).text())switch(s=$(a).text(),t){case 1:s===l&&$(a).css({color:"red","font-weight":"600"});break;case 2:s===d&&$(a).css({color:"blue","font-weight":"600"});break;case 7:s===c&&$(a).css({color:"green","font-weight":"600"}),"0.00"===r&&"T"===s&&(e.data[0][5]="T");break;case 8:s===p&&$(a).css({color:"green","font-weight":"600"}),"0.0"===o&&"T"===s&&(e.data[0][6]="T");break;case 9:s===m&&$(a).css({color:"green","font-weight":"600"})}})}),e.data[0][7]=roundFix(e.data[0][7],1),e.data[0][8]=roundFix(e.data[0][8],1),e.data[0][11]=roundFix(e.data[0][11],1),"intermediate"===u?"M"!==e.data[0][7]&&"M"!==e.data[0][8]&&(e.data[0][9]=roundNum((roundNum(e.data[0][7],1)+roundNum(e.data[0][8],1))/2,1)):e.data[0][9]=roundFix(e.data[0][9],1),"M"!==e.data[0][14]&&(e.data[0][14]=roundStr(e.data[0][14],1)),"M"!==e.data[0][9]&&"M"!==e.data[0][10]?e.data[0][10]=roundStr(e.data[0][9]-roundNum(e.data[0][10],1),1):e.data[0][10]="M",$.each([[1,2,-1,-1,3,4,5,6,-1],[7,8,9,10,-1,-1,-1,-1,11],[12,13,14,-1,15,16,17,18,-1]],function(t,a){i="<th>"+h[t]+"</th>",$.each(a,function(t,a){i+='<td class="col'+(t+1)+'">'+(a>=0?e.data[0][a]:"-")+"</td>"}),$(".tablesorter tfoot").append("<tr>"+i+"</tr>")}),!a||"M"===e.data[0][14]&&"M"===e.data[0][15]&&"M"===e.data[0][16]&&"M"===e.data[0][17]&&"M"===e.data[0][18]||$(".tablesorter tfoot").append('<tr><td colspan="'+t.length+'"><i>Above Normals represent the month through '+input_params.date+".</i></td></tr>"),n=1;n<t.length;n+=1)0===t[n]&&(n>4?$(".col"+n).hide():4===n&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&($(".tcols").hide(),$(".col1").hide(),$(".col2").hide(),$(".col3").hide(),$(".col4").hide()))}function displayMoncrtSmry(e){var t=input_params.sid,a=input_params.eDate,n=input_params.sDate.substr(0,7),i=(new Date).toString("yyyy-MM"),s={sid:t,date:null,elems:[{name:"maxt",interval:"mly",duration:"mly",reduce:"sum"},{name:"mint",interval:"mly",duration:"mly",reduce:"sum"},{name:"hdd",interval:"mly",duration:"mly",reduce:"sum"},{name:"cdd",interval:"mly",duration:"mly",reduce:"sum"},{name:"pcpn",interval:"mly",duration:"mly",reduce:"sum"},{name:"snow",interval:"mly",duration:"mly",reduce:"sum"},{name:"maxt",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"mint",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"avgt",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"avgt",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"snwd",interval:"mly",duration:"mly",reduce:"mean",prec:3},{name:"maxt",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"mint",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"avgt",interval:"mly",duration:"mly",reduce:"mean",normal:"91"},{name:"hdd",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"cdd",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"pcpn",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"snow",interval:"mly",duration:"mly",reduce:"sum",normal:"91"},{name:"maxt",interval:"mly",duration:"mly",reduce:"max"},{name:"mint",interval:"mly",duration:"mly",reduce:"min"},{name:"pcpn",interval:"mly",duration:"mly",reduce:"max"},{name:"snow",interval:"mly",duration:"mly",reduce:"max"},{name:"snwd",interval:"mly",duration:"mly",reduce:"max"}]};i===n?(input_params={sids:t,meta:"valid_daterange",elems:"43,4,10,11"},postResults("/StnMeta",function(t){var n=[];if(!t.meta.length)return $(document).reportError({errorText:"Requested data not available for selected station.",makeActive:$("#inputs .ui-accordion-header").index($("#station_acc"))}),!1;$.each(t.meta[0].valid_daterange,function(e,t){t.length&&n.push(t[1])}),input_params=s,input_params.date=n.sort()[n.length-1],input_params.date!==a&&$.each(input_params.elems,function(e,t){t.duration="mtd",t.interval=[1,0,0]}),postResults("/StnData",function(t){process_smry(t,e,!0)})})):(input_params=s,input_params.date=a,postResults("/StnData",function(t){process_smry(t,e,!1)}))}function displayMoncrt(e){var t,a,n,i=0,s=[0,0,0,0,0,0,0,0,0,0],r=parseInt(input_params.eDate.substr(0,4),10),o=getOutputChoice()||"html",l="",d={},c=input_params.elems,p=column_headers(c,["Date"]),m="Climatological Data for "+buildStationName(e.meta)+" - "+Date.parse(input_params.sDate.substr(0,7)).toString("MMMM yyyy");if("intermediate"===getTempRounding())for(t=0;t<e.data.length;t+=1)"M"!==e.data[t][3][0]&&(n=parseFloat(e.data[t][3]),e.data[t][3][0]=Math.round(n+.001),"M"!==e.data[t][4][0]&&(e.data[t][4][0]=Math.round(n+.001)-Math.round(n-parseFloat(e.data[t][4][0])+.001)));if("html"===o||"csv"===o){for(addDisplayTitle(m,"<br /><span class='subtitle noprint'>Click column heading to sort ascending, click again to sort descending.</span>",o),$(".tablesorter").hide(),addMoncrtHeader(o,p),$.each(e.data,function(e,t){l="",$.each(t,function(e,t){0===e?l+='<td class="col'+e+'" style="white-space:nowrap;">'+t+"</td>":(l+='<td class="col'+e+'">'+("-0"!==t[0]?t[0]:"0")+"</td>","M"!==t[0]&&(s[e]=1,$.inArray(e,[1,2,7,8,9])>=0&&(d[p[e]]||(d[p[e]]=[]),$.inArray(t[1],d[p[e]])<0&&d[p[e]].push(t[1]))))}),addDisplayRow(l,o)}),a=1;a<s.length;a+=1)i+=s[a],0===s[a]&&(a>4?$(".col"+a).hide():4===a&&0===s[1]&&0===s[2]&&0===s[3]&&0===s[4]&&($(".tcols").hide(),$(".col1").hide(),$(".col2").hide(),$(".col3").hide(),$(".col4").hide()));i>0?($(".tablesorter").show(),"html"===o&&($(".tablesorter").tablesorter(),displayMoncrtSmry(s)),addObsTimeTable(d,r,r,o)):$(document).reportError({errorText:"No data for "+e.meta.name+" for "+Date.parse(input_params.sDate.substr(0,7)).toString("MMMM yyyy")})}else"text"===o&&displayMoncrtText(e)}function getStationsSingleInput(){var e=$("#selectedStation");return!!e.data("sid")&&(input_params.sid=e.data("sid"),!0)}function setupChartResizer(){var e=$("#chart_area").highcharts();$("#resizer").resizable({resize:function(){e.setSize(this.offsetWidth-2,this.offsetHeight-2,!1)}}),e.setSize(558,516,!1)}function setInput_moncrt(){$('<div id="tdate_area"></div>').appendTo("#option_select").singleDateSelection({sdFormat:"ym"})}function setInput_almanac(){$('<div id="tdate_area"></div>').appendTo("#option_select").singleDateSelection({sdFormat:"ymd"})}function setInput_monavg(){$('<div id="year_area"></div>').appendTo("#option_select").yearRangeSelection({defaultStart:"2000"}),$(".acis-tyear:first").css("margin-right","3px").prop("title","4-digit starting year ('por' for first year of record)"),$(".acis-tyear:last").css("margin-left","3px").prop("title","4-digit ending year ('por' for last year of record"),$('<div id="element_area"></div>').appendTo("#option_select").elementSelection({reduces:[["sum","Sum"],["mean","Mean"],["max","Daily Maximum"],["min","Daily Minimum"],["cnt","Number of days"]],defElement:"pcpn"}),$(".acis-fsElem").prop("title","Climate element to be summarized"),$(".acis-fsReduce").prop("title","Type of summarization to be performed on the variable for each month"),$(".acis-fsThresh").prop("title","Type of comparison and value (for example, for temperature <= 32 is less than or equal to 32 degrees)"),$('<div id="hidden_area"></div>').appendTo("#option_select").addClass("ui-helper-hidden"),$('<div id="month_area"></div>').appendTo("#hidden_area").monthRangeSelection(),setupMaxmissing("#hidden_area",!0,1),setupSeasonCalcs("#hidden_area"),$(".acis-fsElem select").on("change",function(){$.inArray($(".acis-fsElem select").val(),["snow","snwd","hdd"])>-1?($("#month_area").find("fieldset input:first").val(7),$("#month_area").find("fieldset input:last").val(6)):($("#month_area").find("fieldset input:first").val(1),$("#month_area").find("fieldset input:last").val(12)),"max"===$(".acis-fsReduce select").val()||"min"===$(".acis-fsReduce select").val()?$("#maxMiss").val(999):$.inArray($(".acis-fsElem select").val(),["maxt","mint","avgt"])>-1?$("#maxMiss").val(5):$("#maxMiss").val(1)}),$("#element_area fieldset.acis-fsReduce select").on("change",function(){"mean"===$(this).val()?$("#seasonCalcChoices").removeClass("ui-helper-hidden"):$("#seasonCalcChoices").addClass("ui-helper-hidden"),"max"===$(this).val()||"min"===$(this).val()?$("#maxMiss").val(999):$.inArray($(".acis-fsElem select").val(),["maxt","mint","avgt"])>-1?$("#maxMiss").val(5):$("#maxMiss").val(1)}).trigger("change")}function setInput_dayavg(){$('<div id="year_area"></div>').appendTo("#option_select").yearRangeSelection({defaultStart:"por"}),$(".acis-tyear:first").css("margin-right","3px").prop("title","4-digit starting year ('por' for first year of record)"),$(".acis-tyear:last").css("margin-left","3px").prop("title","4-digit ending year ('por' for last year of record"),$('<div id="element_area"></div>').appendTo("#option_select").elementSelection({reduces:[["mean","Mean"],["max","Daily Maximum"],["min","Daily Minimum"],["cnt","Number of years"]]}),$(".acis-fsElem").prop("title","Climate element to be summarized"),$(".acis-fsReduce").prop("title","Type of summarization to be performed on the variable for each day of the year"),$(".acis-fsThresh").prop("title","Type of comparison and value (for example, for temperature <= 32 is less than or equal to 32 degrees)"),$('<div id="hidden_area"></div>').appendTo("#option_select").addClass("ui-helper-hidden"),setupOccur("#hidden_area","year",!0),$(".acis-fsReduce select").on("change",function(){$(".acis-fsReduce select").val().search("min")>=0||$(".acis-fsReduce select").val().search("max")>=0?$("#occur").prop("checked",!0):$("#occur").prop("checked",!1)})}function setInput_normals(){setupNormalType("#option_select"),$("#normal_type_area fieldset").prop("title","Time step of results"),$('<div id="element_area"></div>').appendTo("#option_select").elementSelection({elements:[["temp","Temperatures"],["pcpn","Precipitation"],["tp","Temperature/Precipitation"],["snow","Snowfall"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"tp",mode:"elementOnly"}),$(".acis-fsElem").prop("title","Climate element or elements to be displayed"),$('<div id="month_area"></div>').appendTo("#option_select").monthRangeSelection().addClass("ui-helper-hidden"),$(".acis-fsElem select").on("change",function(){"snow"===$(".acis-fsElem select").val()||"hdd"===$(".acis-fsElem select").val()?($("#month_area").find("fieldset input:first").val(7),$("#month_area").find("fieldset input:last").val(6)):($("#month_area").find("fieldset input:first").val(1),$("#month_area").find("fieldset input:last").val(12))})}function setInput_oneday(){var e;$('<div id="tdate_area"></div>').appendTo("#option_select").singleDateSelection({sdFormat:"md"}),$('<div id="year_area"></div>').appendTo("#option_select").yearRangeSelection({defaultStart:"2000"}),$(".acis-tyear:first").css("margin-right","3px").prop("title","4-digit starting year"),$(".acis-tyear:last").css("margin-left","3px").prop("title","4-digit ending year"),$(".acis-mdRange").on("keyup change",function(){(e=$(".acis-mdRange").val()).search("2-28")>=0||e.search("2-29")>=0?$(this).tooltip({content:"If date is 2/28 and start year is a non-leap year, summary will be for last day of February. If date is 2/28 and start year is a leap year, summary will be through Feb 28. If date is 2/29, both start and end year must be leap years and summary will be for the last day of February.",position:{my:"left top",at:"right+5 top",of:"#tdate_area fieldset"},tooltipClass:"acis-tooltip smallerBox"}).tooltip("open"):$(this).tooltip()&&$(this).tooltip("destroy")})}function setInput_fldates(){$('<div id="year_area"></div>').appendTo("#option_select").yearRangeSelection({defaultStart:"2000"}),$(".acis-tyear:first").css("margin-right","3px").prop("title","4-digit starting year"),$(".acis-tyear:last").css("margin-left","3px").prop("title","4-digit ending year"),$('<div id="element_area"></div>').appendTo("#option_select").elementSelection({mode:"numberDaysOnly",elements:[["maxt","Max temp"],["mint","Min temp"],["snow","Snowfall"],["snwd","Snow depth"]],defElement:"mint"}),$(".acis-fsThresh input").val(32).prop("title","Type of comparison and value (for example, for temperature <= 32 is less than or equal to 32 degrees)"),$(".acis-fsThresh").css("width","47%"),setupMoreOptions("#option_select","Advanced options"),$(".more_option_header").addClass("ui-helper-clearfix"),setupBeginDate("#more_option_select"),setupGroupResults("#more_option_select"),$("#resGroup").prop("title","Manner in which results are displayed (first/last or last/first)"),$('<div id="hidden_area"></div>').appendTo("#option_select").addClass("ui-helper-hidden"),setupMaxmissing("#hidden_area",!0,5),setTimeout(function(){$(".acis-fsThresh input").focus().select()},200),$(".acis-fsElem select").on("change",function(){$.inArray($(".acis-fsElem select").val(),["maxt","mint"])>-1?($("#maxMiss").val(5),$("#resGroup").val("calyr")):($("#maxMiss").val(1),$("#resGroup").val("season")),"maxt"!==$(".acis-fsElem select").val()?$("#begmmdd").val("08-01"):$("#begmmdd").val("01-01")})}function setInput_dlytmpgrf(){$('<div id="season_area"></div>').appendTo("#option_select").seasonSelection({oneYear:!0}),$("#season_area").removeClass("ui-widget ui-helper-reset"),$(".acis-tyear").select().focus().prop("title","4-digit year of interest")}function setInput_dlyaccgrf(){setupDatesAccum("#option_select"),setupResetAccum("#option_select"),$("#tdate_area fieldset:last").css("margin-top",0).find("label").css({"font-size":"1em","font-weight":"600","margin-right":"2px"}),$('<div id="element_area"></div>').appendTo("#option_select").elementSelection({elements:[["pcpn","Precipitation"],["snow","Snowfall"],["hdd","HDD base 65"],["cdd","CDD base 65"],["gdd","GDD base 50"]],defElement:"pcpn",mode:"elementOnly"}),$(".acis-fsElem").prop("title","Daily climate element to be displayed"),$('<div id="hidden_area"></div>').appendTo("#option_select").addClass("ui-helper-hidden"),setupMaxmissing("#hidden_area",!0,1),setupOtherLines("#hidden_area"),$("#normLine").prop("checked",!0),$("#hiYr").prop("checked",!0),$("#loYr").prop("checked",!0),$("#pickYr").prop("checked",!1)}function setupProduct(){var e={StnProduct_monavg:{setup:setInput_monavg,getinput:getInput_monavg,display:displayMonavg},StnProduct_dayavg:{setup:setInput_dayavg,getinput:getInput_dayavg,display:displayDayavg},StnProduct_normals:{setup:setInput_normals,getinput:getInput_normals,display:displayNormals,graph:!0},StnProduct_fldates:{setup:setInput_fldates,getinput:getInput_fldates,display:displayFirstLast},StnProduct_moncrt:{setup:setInput_moncrt,getinput:getInput_moncrt,display:displayMoncrt},StnProduct_almanac:{setup:setInput_almanac,getinput:getInput_almanac,display:displayAlmanac},StnProduct_oneday:{setup:setInput_oneday,getinput:getInput_oneday,display:displayOneDay},StnProduct_dlytmpgrf:{setup:setInput_dlytmpgrf,getinput:getInput_dlytmpgrf,display:displayTempGrf,graph:!0},StnProduct_dlyaccgrf:{setup:setInput_dlyaccgrf,getinput:getInput_dlyaccgrf,display:displayAccumGrf,graph:!0}},t=$("input[name=product_select]:checked").val();if(!e[t])return!1;$("#description").html(productDescription(t)),$("#product_select").data($.extend(e[t],{productId:t})),$("#option_select").empty(),e[t].setup(),e[t].graph&&loadChartScript()}function buildStationMenu(){var e,t=$("select[name=station]"),a={coop:2,wban:1,icao:5,ghcn:6,shef:7,wmo:4,faa:3,thrdx:9,cocorahs:10,awdn:16,newa:26,any:"any"};$.get("station_list.txt",function(n){(e=$.parseJSON(n))&&0!==e.length?($(e).each(function(e,n){$('<option value="'+n[0]+" "+a[n[2]]+'">'+n[1]+"</option>").appendTo(t)}),t.val(t.children()[0].value),saveStn(t.val(),$("select[name=station] option:selected").text())):($('<option value="">Station list unavailable</option>').appendTo(t),$("#viewMap").remove(),$("#go").parent().remove())})}function resultsToPopup(){$("#results_area").popResults({extraHead:'<link rel="stylesheet" type="text/css" media="all" href="/css/popup.css" /><script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"><\/script><script type="text/javascript" src="/js/packages_1.0.2.min.js"><\/script><script>$(document).ready(function() {$("#results_area").removeClass("ui-dialog-content ui-widget-content");$(".tablesorter").tablesorter();});<\/script>',popTitle:"NOWData Results"}),$("#results_area").dialog("close")}function init_nowdata(){initCommon(),getCwa(),buildStationMenu(),setupProduct(),$("select[name=station]").on("change",function(){saveStn(this.value,$("select[name=station] option:selected").text())}),$("input[name=product_select]").on("click",setupProduct),$("#go").button().on("click",function(){collectInput(obtainResults),$("#results_area").dialog("open")}),$("#viewMap").button().on("click",function(){showMap()}),$("#viewMenu").button().on("click",function(){$("#selectedStation").hide(),$("select[name=station]").show()}),$("#option_select").tooltip({tooltipClass:"acis-tooltip",position:{my:"left center",at:"right+5 center"}}),$("#results_area").dialog({autoOpen:!1,width:562,height:569,modal:!0,position:{my:"left top",at:"left top",of:$(".container")},title:"NOWData - NOAA Online Weather Data"}).parent().find("div.ui-dialog-titlebar span:first").css("width","67%"),$("<button id='printButton'>Print</button>").insertBefore($("#results_area").parents(".ui-dialog").find(".ui-dialog-titlebar-close")).button().on("click",function(){$("#results_area").printArea({mode:"popup",popClose:!0})}),$("<button>Enlarge results</button>").insertBefore($("#printButton")).button().on("click",resultsToPopup),$("#map_area").position({my:"left top",at:"left top",of:".input_block:first"}),$("<div id='helpDialog'></div>").appendTo(document.body).addClass("ui-widget").dialog({autoOpen:!1,width:559,modal:!0,title:"Help",position:{my:"left top",at:"left+5 top+19",of:".container"}}),"#map"===window.location.hash&&$("#viewMap").click()}!function(e){var t={},a={write:function(e,t){var n=e.document;n.open(),n.write("<!DOCTYPE html><html>"+a.getHead()+a.getBody(t)+"</html>"),n.close()},getHead:function(){var a="";return e(document).find("link").each(function(){e(this).attr("media")&&(a+='<link type="text/css" rel="stylesheet" media="'+e(this).attr("media")+'" href="'+e(this).attr("href")+'" >')}),"<head><title>"+t.popTitle+"</title>"+a+t.extraHead+"</head>"},getBody:function(n){var i,s="",r=t.retainAttr;return n.each(function(){var t,n=a.getFormData(e(this)),o="";for(i=0;i<r.length;i+=1)(t=e(n).attr(r[i]))&&(o+=(o.length>0?" ":"")+r[i]+"='"+t+"'");s+="<div "+o+">"+e(n).html()+"</div>"}),"<body>"+s+"</body>"},getFormData:function(t){var a=t.clone(),n=e("input,select,textarea",a);return e("input,select,textarea",t).each(function(t){var a=e(this).attr("type"),i=n.eq(t);"undefined"===e.type(a)&&(a=e(this).is("select")?"select":e(this).is("textarea")?"textarea":""),"radio"===a||"checkbox"===a?i.attr("checked",e(this).is(":checked")):"text"===a?i.attr("value",e(this).val()):"select"===a?e(this).find("option").each(function(t){e(this).is(":selected")&&e("option",i).eq(t).attr("selected",!0)}):"textarea"===a&&i.text(e(this).val())}),a},Popup:function(){var e="location=no,status=no,directories=no,menubar=no,toolbar=no,dependent=no,personalbar=no,scrollbars=yes,resizable=yes,width="+t.popWidth+",height="+t.popHeight+",left="+t.posX+",top="+t.posY;return window.open("","_blank",e)}};e.fn.popResults=function(n){var i,s=e(this);e.extend(t,{popHeight:600,popWidth:700,posX:200,posY:200,popTitle:"",extraHead:"",retainAttr:["id","class","style"]},n),i=a.Popup(),a.write(i,s)}}(jQuery);